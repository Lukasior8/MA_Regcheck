---
title: "Processing MA Results"
author: "Luki"
date: "2024-09-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Datacleaning to dos:

resultate
- wenn preregvorhanden oder paper vorhandene keine Zahl (sondern leer oder  not available) dann die ganze zeile löschen
- sanity kontrollieren dass überall nur x,y, n,m, leer oder zahl ist.
- Prompt versionen renamen
- PreDCP_1_TEXT komische Zahlen verändern

- wieder mergen
- safe to disc
- version control



# Dependancies



```{r}
library(tidyverse)
library("readxl")
library(janitor)
library(stringr)
library(openxlsx)

```

# clean GPT data_gpt

## Read  data


```{r}
data_gpt_raw <- read_excel("../data/DATA_Resultate_raw.xlsx") |>
  janitor::clean_names()
```

##select and remove unwanted columns


```{r}
data_gpt_filtered <- data_gpt_raw %>%
  select(   
    -prereg_vorhanden,
    -paper_vorhanden,
    -gpt_link_extraction,
    -gpt_link_comparison,
    -notes_extraction,
    -notes_comparison,
    -hyp_pre,
    -hyp_pap,
    -type,
    -iv1,
    -iv2,
    -tv,
    -dv,
    -fcv,
    -ocv,
    -starts_with("x")
    )




```

## kategorien alphabetic säubern

```{r}

gpt_categories_alphabetic <- c("pre_pre_mi1", "pre_mi1", "pre_iv1", "c_pre_iv1", "pre_niv1_1", "pre_niv1_2", 
                            "pre_pre_mi2", "pre_mi2", "pre_iv2", "c_pre_iv2", "pre_niv2_1", "pre_niv2_2", 
                            "pre_pre_mt", "pre_mt", "pre_tv", "c_pre_tv", "pre_ntv_1", "pre_ntv_2", 
                            "pre_dv", "c_pre_dv", "pre_ndv_1", "pre_ndv_2", 
                            "pre_pre_mc", "pre_mc", "pre_cv", "c_pre_cv", "pre_ncv_1", "pre_ncv_2", 
                            "pre_dcp_1", "pre_dcp_2", "pre_pa", "pre_iec_1", "pre_imd_1", "pre_imd_2", 
                            "pre_sm_1", "pre_sm_2", "pre_sm_3", 
                            "pre_vsa_1", "pre_vsa_2", "pre_vsa_3", "pre_ic", "pap_pap_mi1", "pap_mi1", 
                            "pap_iv1", "c_pap_iv1", "pap_niv1_1", "pap_niv1_2", "pap_pap_mi2", "pap_mi2", 
                            "pap_iv2", "c_pap_iv2", "pap_niv2_1", "pap_niv2_2", "pap_pap_mt", "pap_mt", 
                            "pap_tv", "c_pap_tv", "pap_ntv_1", "pap_ntv_2", "pap_dv", "c_pap_dv", 
                            "pap_ndv_1", "pap_ndv_2", "pap_pap_mc", "pap_mc", "pap_cv", "c_pap_cv", 
                            "pap_ncv_1", "pap_ncv_2", "pap_dcp_1", "pap_dcp_2", "pap_pa", "pap_iec_1", 
                            "pap_imd_1", "pap_imd_2", "pap_sm_1", "pap_sm_2", "pap_sm_3", "pap_vsa_1", 
                            "pap_vsa_2", "pap_vsa_3", "pap_ic", "match_mi1", "match_iv1_0", "match_iv1_1", 
                            "match_iv1_2", "match_iv1_3", "match_mi2", "match_iv2_0", "match_iv2_1", 
                            "match_iv2_2", "match_iv2_3", "match_mt", "match_tv_0", "match_tv_1", 
                            "match_tv_2", "match_tv_3", "match_dv_0", "match_dv_1", "match_dv_2", 
                            "match_dv_3", "match_mc", "match_cv_0", "match_cv_1", "match_cv_2", 
                            "match_cv_3", "match_dcp_1", "match_dcp_2", "match_iec_1", "match_imd_1", 
                            "match_imd_2",  "match_sm_1", "match_sm_2", "match_sm_3", "match_vsa_1", 
                            "match_vsa_2", "match_vsa_3", "match_ic")


gpt_frequencies_categories <- lapply(data_gpt_filtered[gpt_categories_alphabetic], table)


#frequencies_categories



clean_value <- function(x) {
  cleaned <- tolower(x)     
  cleaned <- gsub("yy", "y", cleaned)  
  cleaned <- gsub("xx", "x", cleaned)  
  cleaned <- gsub("nn", "n", cleaned)  
  return(cleaned)
}


data_gpt_filtered_clean <- data_gpt_filtered %>%
  mutate_at(vars(one_of(gpt_categories_alphabetic)), clean_value)

gpt_frequencies_categories_cleaned <- lapply(data_gpt_filtered_clean[gpt_categories_alphabetic], table)


#gpt_frequencies_categories_cleaned




replace_with_exclude <- function(x) {
  ifelse(x %in% c("x", "y", "n"), x, "exclude")
}


data_gpt_filtered_clean_exclude <- data_gpt_filtered_clean %>%
  mutate_at(vars(one_of(gpt_categories_alphabetic)), replace_with_exclude)

# Check frequencies after cleaning
gpt_frequencies_categories_cleaned_exclude <- lapply(data_gpt_filtered_clean_exclude[gpt_categories_alphabetic], table)

#gpt_frequencies_categories_cleaned_exclude
```

## kategorien numeric säubern

```{r}

# List of column names that need to be converted to numeric
gpt_categories_numeric <- c("pre_dcp_1_text", "pap_dcp_1_text", "s_pre_iv", "s_pre_dv", 
                        "s_pre_dcp", "s_pre_smu", "s_pre_sic", "s_pap_iv", "s_pap_dv", 
                        "s_pap_dcp", "s_pap_smu", "s_pap_sic", "prompt_version_a_strictness_prereg", 
                        "prompt_version_a_strictness_pubstud", "con_iv", "con_dv", 
                        "con_dcp", "con_smu", "con_sic", "global_consistency_esimate")

# Convert to numeric and replace non-numeric with 'exclude'
data_gpt_filtered_clean_exclude_numeric <- data_gpt_filtered_clean_exclude %>%
  mutate_at(vars(one_of(gpt_categories_numeric)), 
            ~ifelse(is.na(as.numeric(.)), "exclude", as.numeric(.)))

# Check frequencies after cleaning
gpt_frequencies_categories_cleaned_exclude_numeric <- lapply(data_gpt_filtered_clean_exclude_numeric[gpt_categories_numeric], table)

#gpt_frequencies_categories_cleaned_exclude_numeric


```


## finish data_gpt_finito

```{r}



# Ändere die Werte "v4" und "V4" in der Spalte prompt_version zu "D"
data_gpt_finito <- data_gpt_filtered_clean_exclude_numeric %>%
  mutate(prompt_version = ifelse(prompt_version %in% c("v4", "V4"), "D", prompt_version))

# Neue Spalte master_exclude hinzufügen und standardmäßig auf "include" setzen
data_gpt_finito <- data_gpt_finito %>%
  mutate(master_exclude = ifelse(is.na(date_gpt), "exclude", "include"))



```
# clean olmos data

## read olmos data

```{r}
DATA_olmo_raw <- read_excel("../data/Data Preregistration Effectiveness.xlsx") |>
  janitor::clean_names()


data_olmo_raw <- DATA_olmo_raw[seq(3, nrow(DATA_olmo_raw), 3), ] # select only reconciled data


#rename  so that "pre_iec", "pap_iec and "match_iec" colum in olmo are also called pre_iec_1`, `pap_iec_1`, and `match_iec_1` like gpt
data_olmo_raw <- data_olmo_raw %>%
  rename(
    pre_iec_1 = pre_iec,
    pap_iec_1 = pap_iec,
    match_iec_1 = match_iec
  )

```


## select only wanted colums

```{r}
olmo_selected_columns <- c(
  "psp", "coder", "pre_pre_mi1", "pre_mi1", "pre_iv1", "c_pre_iv1", "pre_niv1_1", 
  "pre_niv1_2", "pre_niv1_3", "pre_pre_mi2", "pre_mi2", "pre_iv2", "c_pre_iv2", 
  "pre_niv2_1", "pre_niv2_2", "pre_niv2_3", "pre_pre_mt", "pre_mt", "pre_tv", 
  "c_pre_tv", "pre_ntv_1", "pre_ntv_2", "pre_ntv_3", "pre_dv", "c_pre_dv", 
  "pre_ndv_1", "pre_ndv_2", "pre_ndv_3", "pre_pre_mc", "pre_mc", "pre_cv", 
  "c_pre_cv", "pre_ncv_1", "pre_ncv_2", "pre_ncv_3", "pre_dcp_1", "pre_dcp_2", 
  "pre_dcp_3", "pre_dcp_1_text", "pre_pa", "pre_iec_1", 
  "pre_imd_1", "pre_imd_2", "pre_imd_3",
  "pre_sm_1", "pre_sm_2", "pre_sm_3", "pre_sm_4", "pre_vsa_1", "pre_vsa_2", 
  "pre_vsa_3", "pre_vsa_4", "pre_ic", "pap_pap_mi1", "pap_mi1", "pap_iv1", "c_pap_iv1", 
  "pap_niv1_1", "pap_niv1_2", "pap_niv1_3", "pap_pap_mi2", "pap_mi2", "pap_iv2", 
  "c_pap_iv2", "pap_niv2_1", "pap_niv2_2", "pap_niv2_3", "pap_pap_mt", "pap_mt", 
  "pap_tv", "c_pap_tv", "pap_ntv_1", "pap_ntv_2", "pap_ntv_3", "pap_dv", "c_pap_dv", 
  "pap_ndv_1", "pap_ndv_2", "pap_ndv_3", "pap_pap_mc", "pap_mc", "pap_cv", "c_pap_cv", 
  "pap_ncv_1", "pap_ncv_2", "pap_ncv_3", "pap_dcp_1", "pap_dcp_2", "pap_dcp_3", 
  "pap_dcp_1_text", "pap_pa", "pap_iec_1",
  "pap_imd_1", "pap_imd_2", "pap_imd_3", "pap_sm_1", 
  "pap_sm_2", "pap_sm_3", "pap_sm_4", "pap_vsa_1", "pap_vsa_2", "pap_vsa_3", 
  "pap_vsa_4", "pap_ic", "match_mi1", "match_iv1_0", "match_iv1_1", "match_iv1_2", 
  "match_iv1_3", "match_iv1_4", "match_mi2", "match_iv2_0", "match_iv2_1", 
  "match_iv2_2", "match_iv2_3", "match_iv2_4", "match_mt", "match_tv_0", 
  "match_tv_1", "match_tv_2", "match_tv_3", "match_tv_4", "match_dv_0", "match_dv_1", 
  "match_dv_2", "match_dv_3", "match_dv_4", "match_mc", "match_cv_0", "match_cv_1", 
  "match_cv_2", "match_cv_3", "match_cv_4", "match_dcp_1", "match_dcp_2", 
  "match_dcp_3", "match_iec_1", 
  "match_imd_1", "match_imd_2", "match_imd_3","match_sm_1", 
  "match_sm_2", "match_sm_3", "match_sm_4", "match_vsa_1", "match_vsa_2", 
  "match_vsa_3", "match_vsa_4", "match_ic"
)


data_olmo_raw_selected <- data_olmo_raw %>%
  select(all_of(olmo_selected_columns)) 




```


## mutate answers
### renaming

```{r}



# Liste der Datentypen aller Variablen
sapply(data_olmo_raw_selected, class)


data_olmo_selected_mutated <- data_olmo_raw_selected %>%
  mutate_if(is.character, ~ case_when(
    . == "No" ~ "n",
    . == "Yes" ~ "y",
    . == "Composite" ~ "y",
    . == "Non-composite" ~ "n",
    . == "Yes, procedure" ~ "y",
    . == "Yes, values" ~ "y",
    . == "Yes, sample size" ~ "y",
    . == "Yes, sampling frame" ~ "y",
    . == "Yes, definition" ~ "y",
    . == "Yes, model" ~ "y",
    . == "Yes, variables" ~ "y",
    . == "Yes, details" ~ "y",
    . == "Yes, which" ~ "y",
    . == "Yes, how" ~ "y",
    . == "Yes, deal" ~ "y",
    . == "Yes, specification" ~ "y",
    . == "Yes, construction" ~ "y",
    . == "Yes, method" ~ "y",
    TRUE ~ .
  ))





```


### 2 possibilities

for defining what counts as an x (because an answer is not applicable) or as an "n" there are many dependencies to account for, and two main possibilities:

a) desribe all dependencies:

- if pre_pre_mi1 = n then NA of pre_mi1 -> x
- if pre_pre_mi1 = y then NA of pre_iv1, c_pre_iv1, pre_niv1_1, pre_niv1_2, pre_niv1_3 -> x
- if pre_pre_mi1 = n & c_pre_iv1 = y then NA of pre_niv1_1, pre_niv1_2, pre_niv1_3  -> x
- if pre_iv1 = n  then NA of c_pre_iv1, pre_niv1_1, pre_niv1_2, pre_niv1_3  -> x
- if pre_niv1_3 = no,none then NA of pre_niv1_1, pre_niv1_2 -> n
- if pre_niv1_1 or pre_niv1_2 = y then NA of pre_niv1_1 or pre_niv1_2 -> n 


b) simpler version

- if NA -> x 

except if

- if pre_niv1_3 = no,none then NA of pre_niv1_1, pre_niv1_2 -> n
- if pre_niv1_1 or pre_niv1_2 = y then NA of pre_niv1_1 or pre_niv1_2 -> n 


### IV 1
```{r}

data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pre_niv1_1 = case_when(
      pre_niv1_3 == "No, none of the elements" & is.na(pre_niv1_1) ~ "n", 
      pre_niv1_2 == "y" & is.na(pre_niv1_1) ~ "n",                         
      TRUE ~ pre_niv1_1                    
    ),
    
    pre_niv1_2 = case_when(
      pre_niv1_3 == "No, none of the elements" & is.na(pre_niv1_2) ~ "n", 
      pre_niv1_1 == "y" & is.na(pre_niv1_2) ~ "n",                         
      TRUE ~ pre_niv1_2                    
    ),
    
    pre_pre_mi1 = ifelse(is.na(pre_pre_mi1), "x", pre_pre_mi1),
    pre_mi1 = ifelse(is.na(pre_mi1), "x", pre_mi1),
    pre_iv1 = ifelse(is.na(pre_iv1), "x", pre_iv1),
    c_pre_iv1 = ifelse(is.na(c_pre_iv1), "x", c_pre_iv1),
    pre_niv1_1 = ifelse(is.na(pre_niv1_1), "x", pre_niv1_1),
    pre_niv1_2 = ifelse(is.na(pre_niv1_2), "x", pre_niv1_2)
    # pre_niv1_3 = ifelse(is.na(pre_niv1_3), "x", pre_niv1_3)
)


```


### IV 2

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pre_niv2_1 = case_when(
      pre_niv2_3 == "No, none of the elements" & is.na(pre_niv2_1) ~ "n", 
      pre_niv2_2 == "y" & is.na(pre_niv2_1) ~ "n",                         
      TRUE ~ pre_niv2_1                    
    ),
    
    pre_niv2_2 = case_when(
      pre_niv2_3 == "No, none of the elements" & is.na(pre_niv2_2) ~ "n", 
      pre_niv2_1 == "y" & is.na(pre_niv2_2) ~ "n",                         
      TRUE ~ pre_niv2_2                    
    ),
    
    pre_pre_mi2 = ifelse(is.na(pre_pre_mi2), "x", pre_pre_mi2),
    pre_mi2 = ifelse(is.na(pre_mi2), "x", pre_mi2),
    pre_iv2 = ifelse(is.na(pre_iv2), "x", pre_iv2),
    c_pre_iv2 = ifelse(is.na(c_pre_iv2), "x", c_pre_iv2),
    pre_niv2_1 = ifelse(is.na(pre_niv2_1), "x", pre_niv2_1),
    pre_niv2_2 = ifelse(is.na(pre_niv2_2), "x", pre_niv2_2)
    # pre_niv2_3 = ifelse(is.na(pre_niv2_3), "x", pre_niv2_3)
)


```

### TV

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pre_ntv_1 = case_when(
      pre_ntv_3 == "No, none of the elements" & is.na(pre_ntv_1) ~ "n", 
      pre_ntv_2 == "y" & is.na(pre_ntv_1) ~ "n",                         
      TRUE ~ pre_ntv_1                    
    ),
 
    pre_ntv_2 = case_when(
      pre_ntv_3 == "No, none of the elements" & is.na(pre_ntv_2) ~ "n", 
      pre_ntv_1 == "y" & is.na(pre_ntv_2) ~ "n",                         
      TRUE ~ pre_ntv_2                    
    ),

    pre_pre_mt = ifelse(is.na(pre_pre_mt), "x", pre_pre_mt),
    pre_mt = ifelse(is.na(pre_mt), "x", pre_mt),
    pre_tv = ifelse(is.na(pre_tv), "x", pre_tv),
    c_pre_tv = ifelse(is.na(c_pre_tv), "x", c_pre_tv),
    pre_ntv_1 = ifelse(is.na(pre_ntv_1), "x", pre_ntv_1),
    pre_ntv_2 = ifelse(is.na(pre_ntv_2), "x", pre_ntv_2)
    # pre_ntv_3 = ifelse(is.na(pre_ntv_3), "x", pre_ntv_3)
)



```

### DV

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pre_ndv_1 = case_when(
      pre_ndv_3 == "No, none of the elements" & is.na(pre_ndv_1) ~ "n", 
      pre_ndv_2 == "y" & is.na(pre_ndv_1) ~ "n",                         
      TRUE ~ pre_ndv_1                    
    ),
    
    pre_ndv_2 = case_when(
      pre_ndv_3 == "No, none of the elements" & is.na(pre_ndv_2) ~ "n", 
      pre_ndv_1 == "y" & is.na(pre_ndv_2) ~ "n",                         
      TRUE ~ pre_ndv_2                    
    ),
    
    pre_dv = ifelse(is.na(pre_dv), "x", pre_dv),
    c_pre_dv = ifelse(is.na(c_pre_dv), "x", c_pre_dv),
    pre_ndv_1 = ifelse(is.na(pre_ndv_1), "x", pre_ndv_1),
    pre_ndv_2 = ifelse(is.na(pre_ndv_2), "x", pre_ndv_2)
    # pre_ndv_3 = ifelse(is.na(pre_ndv_3), "x", pre_ndv_3)
)

```

### CV

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pre_ncv_1 = case_when(
      pre_ncv_3 == "No, none of the elements" & is.na(pre_ncv_1) ~ "n", 
      pre_ncv_2 == "y" & is.na(pre_ncv_1) ~ "n",                         
      TRUE ~ pre_ncv_1                    
    ),
    
    pre_ncv_2 = case_when(
      pre_ncv_3 == "No, none of the elements" & is.na(pre_ncv_2) ~ "n", 
      pre_ncv_1 == "y" & is.na(pre_ncv_2) ~ "n",                         
      TRUE ~ pre_ncv_2                    
    ),
    
    pre_pre_mc = ifelse(is.na(pre_pre_mc), "x", pre_pre_mc),
    pre_mc = ifelse(is.na(pre_mc), "x", pre_mc),
    pre_cv = ifelse(is.na(pre_cv), "x", pre_cv),
    c_pre_cv = ifelse(is.na(c_pre_cv), "x", c_pre_cv),
    pre_ncv_1 = ifelse(is.na(pre_ncv_1), "x", pre_ncv_1),
    pre_ncv_2 = ifelse(is.na(pre_ncv_2), "x", pre_ncv_2)
    # pre_ncv_3 = ifelse(is.na(pre_ncv_3), "x", pre_ncv_3)
)



```

### DCP

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pre_dcp_1 = case_when(
      pre_dcp_3 == "No, none of the elements" & is.na(pre_dcp_1) ~ "n", 
      pre_dcp_2 == "y" & is.na(pre_dcp_1) ~ "n",                         
      TRUE ~ pre_dcp_1                   
    ),
    
    pre_dcp_2 = case_when(
      pre_dcp_3 == "No, none of the elements" & is.na(pre_dcp_2) ~ "n", 
      pre_dcp_1 == "y" & is.na(pre_dcp_2) ~ "n",                         
      TRUE ~ pre_dcp_2                    
    ),

    pre_dcp_1 = ifelse(is.na(pre_dcp_1), "x", pre_dcp_1),
    pre_dcp_2 = ifelse(is.na(pre_dcp_2), "x", pre_dcp_2)
    # pre_dcp_3 = ifelse(is.na(pre_dcp_3), "x", pre_dcp_3)
)



```

### PA/IEC/IMD

achtung pre_iec (pre_iec_1) hatte eine andere Beschriftung im variabel-lexikon von olmo, und nur yes, deshalb eventuell später droppen

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pre_imd_1 = case_when(
      pre_imd_3 == "No, none of the elements" & is.na(pre_imd_1) ~ "n", 
      pre_imd_2 == "y" & is.na(pre_imd_1) ~ "n",                         
      TRUE ~ pre_imd_1                   
    ),
    
    pre_imd_2 = case_when(
      pre_imd_3 == "No, none of the elements" & is.na(pre_imd_2) ~ "n", 
      pre_imd_1 == "y" & is.na(pre_imd_2) ~ "n",                         
      TRUE ~ pre_imd_2                    
    ),
    
    pre_pa = ifelse(is.na(pre_pa), "x", pre_pa),
    pre_iec_1 = ifelse(is.na(pre_iec_1), "x", pre_iec_1),
    pre_imd_1 = ifelse(is.na(pre_imd_1), "x", pre_imd_1),
    pre_imd_2 = ifelse(is.na(pre_imd_2), "x", pre_imd_2)
    # pre_imd_3 = ifelse(is.na(pre_imd_3), "x", pre_imd_3)
)


```


### SM

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pre_sm_1 = case_when(
      pre_sm_4 == "No, none of the elements" & is.na(pre_sm_1) ~ "n",  
      (pre_sm_2 == "y" | pre_sm_3 == "y") & is.na(pre_sm_1) ~ "n",       
      TRUE ~ pre_sm_1                   
    ),
    
    pre_sm_2 = case_when(
      pre_sm_4 == "No, none of the elements" & is.na(pre_sm_2) ~ "n",  
      (pre_sm_1 == "y" | pre_sm_3 == "y") & is.na(pre_sm_2) ~ "n",       
      TRUE ~ pre_sm_2                        
    ),
    
    pre_sm_3 = case_when(
      pre_sm_4 == "No, none of the elements" & is.na(pre_sm_3) ~ "n",  
      (pre_sm_1 == "y" | pre_sm_2 == "y") & is.na(pre_sm_3) ~ "n",       
      TRUE ~ pre_sm_3                       
    ),

    pre_sm_1 = ifelse(is.na(pre_sm_1), "x", pre_sm_1),
    pre_sm_2 = ifelse(is.na(pre_sm_2), "x", pre_sm_2),
    pre_sm_3 = ifelse(is.na(pre_sm_3), "x", pre_sm_3)
    # pre_sm_4 = ifelse(is.na(pre_sm_4), "x", pre_sm_4)
)


```

### ic /vsa

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pre_vsa_1 = case_when(
      pre_vsa_4 == "No, none of the elements" & is.na(pre_vsa_1) ~ "n",  
      (pre_vsa_2 == "y" | pre_vsa_3 == "y") & is.na(pre_vsa_1) ~ "n",       
      TRUE ~ pre_vsa_1                    
    ),
    
    pre_vsa_2 = case_when(
      pre_vsa_4 == "No, none of the elements" & is.na(pre_vsa_2) ~ "n",  
      (pre_vsa_1 == "y" | pre_vsa_3 == "y") & is.na(pre_vsa_2) ~ "n",       
      TRUE ~ pre_vsa_2                    
    ),
    
    pre_vsa_3 = case_when(
      pre_vsa_4 == "No, none of the elements" & is.na(pre_vsa_3) ~ "n",  
      (pre_vsa_1 == "y" | pre_vsa_2 == "y") & is.na(pre_vsa_3) ~ "n",       
      TRUE ~ pre_vsa_3                    
    ),
    
    pre_ic = ifelse(is.na(pre_ic), "x", pre_ic),
    pre_vsa_1 = ifelse(is.na(pre_vsa_1), "x", pre_vsa_1),
    pre_vsa_2 = ifelse(is.na(pre_vsa_2), "x", pre_vsa_2),
    pre_vsa_3 = ifelse(is.na(pre_vsa_3), "x", pre_vsa_3)
    # pre_vsa_4 = ifelse(is.na(pre_vsa_4), "x", pre_vsa_4)
)


```

## PAP mutation
### IV 1

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pap_niv1_1 = case_when(
      pap_niv1_3 == "No, none of the elements" & is.na(pap_niv1_1) ~ "n", 
      pap_niv1_2 == "y" & is.na(pap_niv1_1) ~ "n",                         
      TRUE ~ pap_niv1_1                   
    ),
    
    pap_niv1_2 = case_when(
      pap_niv1_3 == "No, none of the elements" & is.na(pap_niv1_2) ~ "n", 
      pap_niv1_1 == "y" & is.na(pap_niv1_2) ~ "n",                         
      TRUE ~ pap_niv1_2                    
    ),
    
    pap_pap_mi1 = ifelse(is.na(pap_pap_mi1), "x", pap_pap_mi1),
    pap_mi1 = ifelse(is.na(pap_mi1), "x", pap_mi1),
    pap_iv1 = ifelse(is.na(pap_iv1), "x", pap_iv1),
    c_pap_iv1 = ifelse(is.na(c_pap_iv1), "x", c_pap_iv1),
    pap_niv1_1 = ifelse(is.na(pap_niv1_1), "x", pap_niv1_1),
    pap_niv1_2 = ifelse(is.na(pap_niv1_2), "x", pap_niv1_2)
    # pap_niv1_3 = ifelse(is.na(pap_niv1_3), "x", pap_niv1_3)
)


```


### IV 2

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pap_niv2_1 = case_when(
      pap_niv2_3 == "No, none of the elements" & is.na(pap_niv2_1) ~ "n", 
      pap_niv2_2 == "y" & is.na(pap_niv2_1) ~ "n",                         
      TRUE ~ pap_niv2_1                   
    ),
    
    pap_niv2_2 = case_when(
      pap_niv2_3 == "No, none of the elements" & is.na(pap_niv2_2) ~ "n", 
      pap_niv2_1 == "y" & is.na(pap_niv2_2) ~ "n",                         
      TRUE ~ pap_niv2_2                    
    ),
    
    pap_pap_mi2 = ifelse(is.na(pap_pap_mi2), "x", pap_pap_mi2),
    pap_mi2 = ifelse(is.na(pap_mi2), "x", pap_mi2),
    pap_iv2 = ifelse(is.na(pap_iv2), "x", pap_iv2),
    c_pap_iv2 = ifelse(is.na(c_pap_iv2), "x", c_pap_iv2),
    pap_niv2_1 = ifelse(is.na(pap_niv2_1), "x", pap_niv2_1),
    pap_niv2_2 = ifelse(is.na(pap_niv2_2), "x", pap_niv2_2)
    # pap_niv2_3 = ifelse(is.na(pap_niv2_3), "x", pap_niv2_3)
)


```


### TV

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pap_ntv_1 = case_when(
      pap_ntv_3 == "No, none of the elements" & is.na(pap_ntv_1) ~ "n", 
      pap_ntv_2 == "y" & is.na(pap_ntv_1) ~ "n",                         
      TRUE ~ pap_ntv_1                   
    ),

    pap_ntv_2 = case_when(
      pap_ntv_3 == "No, none of the elements" & is.na(pap_ntv_2) ~ "n", 
      pap_ntv_1 == "y" & is.na(pap_ntv_2) ~ "n",                         
      TRUE ~ pap_ntv_2                    
    ),

    pap_pap_mt = ifelse(is.na(pap_pap_mt), "x", pap_pap_mt),
    pap_mt = ifelse(is.na(pap_mt), "x", pap_mt),
    pap_tv = ifelse(is.na(pap_tv), "x", pap_tv),
    c_pap_tv = ifelse(is.na(c_pap_tv), "x", c_pap_tv),
    pap_ntv_1 = ifelse(is.na(pap_ntv_1), "x", pap_ntv_1),
    pap_ntv_2 = ifelse(is.na(pap_ntv_2), "x", pap_ntv_2)
    # pap_ntv_3 = ifelse(is.na(pap_ntv_3), "x", pap_ntv_3)
)


```


### dv

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pap_ndv_1 = case_when(
      pap_ndv_3 == "No, none of the elements" & is.na(pap_ndv_1) ~ "n", 
      pap_ndv_2 == "y" & is.na(pap_ndv_1) ~ "n",                         
      TRUE ~ pap_ndv_1                   
    ),
    
    pap_ndv_2 = case_when(
      pap_ndv_3 == "No, none of the elements" & is.na(pap_ndv_2) ~ "n", 
      pap_ndv_1 == "y" & is.na(pap_ndv_2) ~ "n",                         
      TRUE ~ pap_ndv_2                    
    ),
    
    pap_dv = ifelse(is.na(pap_dv), "x", pap_dv),
    c_pap_dv = ifelse(is.na(c_pap_dv), "x", c_pap_dv),
    pap_ndv_1 = ifelse(is.na(pap_ndv_1), "x", pap_ndv_1),
    pap_ndv_2 = ifelse(is.na(pap_ndv_2), "x", pap_ndv_2)
    # pap_ndv_3 = ifelse(is.na(pap_ndv_3), "x", pap_ndv_3)
)


```


### CV

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pap_ncv_1 = case_when(
      pap_ncv_3 == "No, none of the elements" & is.na(pap_ncv_1) ~ "n", 
      pap_ncv_2 == "y" & is.na(pap_ncv_1) ~ "n",                         
      TRUE ~ pap_ncv_1                   
    ),
    
    pap_ncv_2 = case_when(
      pap_ncv_3 == "No, none of the elements" & is.na(pap_ncv_2) ~ "n", 
      pap_ncv_1 == "y" & is.na(pap_ncv_2) ~ "n",                         
      TRUE ~ pap_ncv_2                    
    ),
    
    pap_pap_mc = ifelse(is.na(pap_pap_mc), "x", pap_pap_mc),
    pap_mc = ifelse(is.na(pap_mc), "x", pap_mc),
    pap_cv = ifelse(is.na(pap_cv), "x", pap_cv),
    c_pap_cv = ifelse(is.na(c_pap_cv), "x", c_pap_cv),
    pap_ncv_1 = ifelse(is.na(pap_ncv_1), "x", pap_ncv_1),
    pap_ncv_2 = ifelse(is.na(pap_ncv_2), "x", pap_ncv_2)
    # pap_ncv_3 = ifelse(is.na(pap_ncv_3), "x", pap_ncv_3)
)


```


### DCP

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pap_dcp_1 = case_when(
      pap_dcp_3 == "No, none of the elements" & is.na(pap_dcp_1) ~ "n", 
      pap_dcp_2 == "y" & is.na(pap_dcp_1) ~ "n",                         
      TRUE ~ pap_dcp_1                   
    ),
    
    pap_dcp_2 = case_when(
      pap_dcp_3 == "No, none of the elements" & is.na(pap_dcp_2) ~ "n", 
      pap_dcp_1 == "y" & is.na(pap_dcp_2) ~ "n",                         
      TRUE ~ pap_dcp_2                    
    ),

    pap_dcp_1 = ifelse(is.na(pap_dcp_1), "x", pap_dcp_1),
    pap_dcp_2 = ifelse(is.na(pap_dcp_2), "x", pap_dcp_2)
    # pap_dcp_3 = ifelse(is.na(pap_dcp_3), "x", pap_dcp_3)
)

```


### PA/IEC/IMD

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pap_imd_1 = case_when(
      pap_imd_3 == "No, none of the elements" & is.na(pap_imd_1) ~ "n", 
      pap_imd_2 == "y" & is.na(pap_imd_1) ~ "n",                         
      TRUE ~ pap_imd_1                   
    ),
    
    pap_imd_2 = case_when(
      pap_imd_3 == "No, none of the elements" & is.na(pap_imd_2) ~ "n", 
      pap_imd_1 == "y" & is.na(pap_imd_2) ~ "n",                         
      TRUE ~ pap_imd_2                    
    ),
    
    pap_pa = ifelse(is.na(pap_pa), "x", pap_pa),
    pap_iec_1 = ifelse(is.na(pap_iec_1), "x", pap_iec_1),
    pap_imd_1 = ifelse(is.na(pap_imd_1), "x", pap_imd_1),
    pap_imd_2 = ifelse(is.na(pap_imd_2), "x", pap_imd_2),
    #pap_imd_3 = ifelse(is.na(pap_imd_3), "x", pap_imd_3)
)


```


### SM

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pap_sm_1 = case_when(
      pap_sm_4 == "No, none of the elements" & is.na(pap_sm_1) ~ "n",  
      (pap_sm_2 == "y" | pap_sm_3 == "y") & is.na(pap_sm_1) ~ "n",       
      TRUE ~ pap_sm_1                    
    ),
    
    pap_sm_2 = case_when(
      pap_sm_4 == "No, none of the elements" & is.na(pap_sm_2) ~ "n",  
      (pap_sm_1 == "y" | pap_sm_3 == "y") & is.na(pap_sm_2) ~ "n",       
      TRUE ~ pap_sm_2                    
    ),
    
    pap_sm_3 = case_when(
      pap_sm_4 == "No, none of the elements" & is.na(pap_sm_3) ~ "n",  
      (pap_sm_1 == "y" | pap_sm_2 == "y") & is.na(pap_sm_3) ~ "n",       
      TRUE ~ pap_sm_3                    
    ),

    pap_sm_1 = ifelse(is.na(pap_sm_1), "x", pap_sm_1),
    pap_sm_2 = ifelse(is.na(pap_sm_2), "x", pap_sm_2),
    pap_sm_3 = ifelse(is.na(pap_sm_3), "x", pap_sm_3)
    # pap_sm_4 = ifelse(is.na(pap_sm_4), "x", pap_sm_4)
)


```

### Ic/vsa

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    pap_vsa_1 = case_when(
      pap_vsa_4 == "No, none of the elements" & is.na(pap_vsa_1) ~ "n",  
      (pap_vsa_2 == "y" | pap_vsa_3 == "y") & is.na(pap_vsa_1) ~ "n",       
      TRUE ~ pap_vsa_1                    
    ),
    
    pap_vsa_2 = case_when(
      pap_vsa_4 == "No, none of the elements" & is.na(pap_vsa_2) ~ "n",  
      (pap_vsa_1 == "y" | pap_vsa_3 == "y") & is.na(pap_vsa_2) ~ "n",       
      TRUE ~ pap_vsa_2                    
    ),
    
    pap_vsa_3 = case_when(
      pap_vsa_4 == "No, none of the elements" & is.na(pap_vsa_3) ~ "n",  
      (pap_vsa_1 == "y" | pap_vsa_2 == "y") & is.na(pap_vsa_3) ~ "n",       
      TRUE ~ pap_vsa_3                    
    ),
    
    pap_ic = ifelse(is.na(pap_ic), "x", pap_ic),
    pap_vsa_1 = ifelse(is.na(pap_vsa_1), "x", pap_vsa_1),
    pap_vsa_2 = ifelse(is.na(pap_vsa_2), "x", pap_vsa_2),
    pap_vsa_3 = ifelse(is.na(pap_vsa_3), "x", pap_vsa_3)
    # pap_vsa_4 = ifelse(is.na(pap_vsa_4), "x", pap_vsa_4)
)


```

## MATch Mutate
### Iv 1

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    match_iv1_0 = case_when(
      match_iv1_4 == "No, none of the elements are consistent" & is.na(match_iv1_0) ~ "n",  
      (match_iv1_1 == "y" | match_iv1_2 == "y" | match_iv1_3 == "y") & is.na(match_iv1_0) ~ "n",       
      TRUE ~ match_iv1_0                    
    ),
    
    match_iv1_1 = case_when(
      match_iv1_4 == "No, none of the elements are consistent" & is.na(match_iv1_1) ~ "n",  
      (match_iv1_0 == "y" | match_iv1_2 == "y" | match_iv1_3 == "y") & is.na(match_iv1_1) ~ "n",       
      TRUE ~ match_iv1_1                    
    ),
    
    match_iv1_2 = case_when(
      match_iv1_4 == "No, none of the elements are consistent" & is.na(match_iv1_2) ~ "n",  
      (match_iv1_0 == "y" | match_iv1_1 == "y" | match_iv1_3 == "y") & is.na(match_iv1_2) ~ "n",       
      TRUE ~ match_iv1_2                    
    ),
    
    match_iv1_3 = case_when(
      match_iv1_4 == "No, none of the elements are consistent" & is.na(match_iv1_3) ~ "n",  
      (match_iv1_0 == "y" | match_iv1_1 == "y" | match_iv1_2 == "y") & is.na(match_iv1_3) ~ "n",       
      TRUE ~ match_iv1_3                    
    ),

    match_mi1 = ifelse(is.na(match_mi1), "x", match_mi1),
    match_iv1_0 = ifelse(is.na(match_iv1_0), "x", match_iv1_0),
    match_iv1_1 = ifelse(is.na(match_iv1_1), "x", match_iv1_1),
    match_iv1_2 = ifelse(is.na(match_iv1_2), "x", match_iv1_2),
    match_iv1_3 = ifelse(is.na(match_iv1_3), "x", match_iv1_3)
    # match_iv1_4 = ifelse(is.na(match_iv1_4), "x", match_iv1_4)
)


```

### IV 2

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    match_iv2_0 = case_when(
      match_iv2_4 == "No, none of the elements are consistent" & is.na(match_iv2_0) ~ "n",  
      (match_iv2_1 == "y" | match_iv2_2 == "y" | match_iv2_3 == "y") & is.na(match_iv2_0) ~ "n",       
      TRUE ~ match_iv2_0                    
    ),
    
    match_iv2_1 = case_when(
      match_iv2_4 == "No, none of the elements are consistent" & is.na(match_iv2_1) ~ "n",  
      (match_iv2_0 == "y" | match_iv2_2 == "y" | match_iv2_3 == "y") & is.na(match_iv2_1) ~ "n",       
      TRUE ~ match_iv2_1                    
    ),
    
    match_iv2_2 = case_when(
      match_iv2_4 == "No, none of the elements are consistent" & is.na(match_iv2_2) ~ "n",  
      (match_iv2_0 == "y" | match_iv2_1 == "y" | match_iv2_3 == "y") & is.na(match_iv2_2) ~ "n",       
      TRUE ~ match_iv2_2                    
    ),
    
    match_iv2_3 = case_when(
      match_iv2_4 == "No, none of the elements are consistent" & is.na(match_iv2_3) ~ "n",  
      (match_iv2_0 == "y" | match_iv2_1 == "y" | match_iv2_2 == "y") & is.na(match_iv2_3) ~ "n",       
      TRUE ~ match_iv2_3                    
    ),

    match_mi2 = ifelse(is.na(match_mi2), "x", match_mi2),
    match_iv2_0 = ifelse(is.na(match_iv2_0), "x", match_iv2_0),
    match_iv2_1 = ifelse(is.na(match_iv2_1), "x", match_iv2_1),
    match_iv2_2 = ifelse(is.na(match_iv2_2), "x", match_iv2_2),
    match_iv2_3 = ifelse(is.na(match_iv2_3), "x", match_iv2_3)
    # match_iv2_4 = ifelse(is.na(match_iv2_4), "x", match_iv2_4)
)


```

### TV

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    match_tv_0 = case_when(
      match_tv_4 == "No, none of the elements are consistent" & is.na(match_tv_0) ~ "n",  
      (match_tv_1 == "y" | match_tv_2 == "y" | match_tv_3 == "y") & is.na(match_tv_0) ~ "n",       
      TRUE ~ match_tv_0                    
    ),
    
    match_tv_1 = case_when(
      match_tv_4 == "No, none of the elements are consistent" & is.na(match_tv_1) ~ "n",  
      (match_tv_0 == "y" | match_tv_2 == "y" | match_tv_3 == "y") & is.na(match_tv_1) ~ "n",       
      TRUE ~ match_tv_1                    
    ),
    
    match_tv_2 = case_when(
      match_tv_4 == "No, none of the elements are consistent" & is.na(match_tv_2) ~ "n",  
      (match_tv_0 == "y" | match_tv_1 == "y" | match_tv_3 == "y") & is.na(match_tv_2) ~ "n",       
      TRUE ~ match_tv_2                    
    ),
    
    match_tv_3 = case_when(
      match_tv_4 == "No, none of the elements are consistent" & is.na(match_tv_3) ~ "n",  
      (match_tv_0 == "y" | match_tv_1 == "y" | match_tv_2 == "y") & is.na(match_tv_3) ~ "n",       
      TRUE ~ match_tv_3                    
    ),

    match_mt = ifelse(is.na(match_mt), "x", match_mt),
    match_tv_0 = ifelse(is.na(match_tv_0), "x", match_tv_0),
    match_tv_1 = ifelse(is.na(match_tv_1), "x", match_tv_1),
    match_tv_2 = ifelse(is.na(match_tv_2), "x", match_tv_2),
    match_tv_3 = ifelse(is.na(match_tv_3), "x", match_tv_3)
    # match_tv_4 = ifelse(is.na(match_tv_4), "x", match_tv_4)
)


```

### DV

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    match_dv_0 = case_when(
      match_dv_4 == "No, none of the elements are consistent" & is.na(match_dv_0) ~ "n",  
      (match_dv_1 == "y" | match_dv_2 == "y" | match_dv_3 == "y") & is.na(match_dv_0) ~ "n",       
      TRUE ~ match_dv_0                    
    ),
    
    match_dv_1 = case_when(
      match_dv_4 == "No, none of the elements are consistent" & is.na(match_dv_1) ~ "n",  
      (match_dv_0 == "y" | match_dv_2 == "y" | match_dv_3 == "y") & is.na(match_dv_1) ~ "n",       
      TRUE ~ match_dv_1                    
    ),
    
    match_dv_2 = case_when(
      match_dv_4 == "No, none of the elements are consistent" & is.na(match_dv_2) ~ "n",  
      (match_dv_0 == "y" | match_dv_1 == "y" | match_dv_3 == "y") & is.na(match_dv_2) ~ "n",       
      TRUE ~ match_dv_2                    
    ),
    
    match_dv_3 = case_when(
      match_dv_4 == "No, none of the elements" & is.na(match_dv_3) ~ "n",  
      (match_dv_0 == "y" | match_dv_1 == "y" | match_dv_2 == "y") & is.na(match_dv_3) ~ "n",       
      TRUE ~ match_dv_3                    
    ),

    match_dv_0 = ifelse(is.na(match_dv_0), "x", match_dv_0),
    match_dv_1 = ifelse(is.na(match_dv_1), "x", match_dv_1),
    match_dv_2 = ifelse(is.na(match_dv_2), "x", match_dv_2),
    match_dv_3 = ifelse(is.na(match_dv_3), "x", match_dv_3)
    # match_dv_4 = ifelse(is.na(match_dv_4), "x", match_dv_4)
)


```

### CV

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    match_cv_0 = case_when(
      match_cv_4 == "No, none of the elements are consistent" & is.na(match_cv_0) ~ "n",  
      (match_cv_1 == "y" | match_cv_2 == "y" | match_cv_3 == "y") & is.na(match_cv_0) ~ "n",       
      TRUE ~ match_cv_0                    
    ),
    
    match_cv_1 = case_when(
      match_cv_4 == "No, none of the elements are consistent" & is.na(match_cv_1) ~ "n",  
      (match_cv_0 == "y" | match_cv_2 == "y" | match_cv_3 == "y") & is.na(match_cv_1) ~ "n",       
      TRUE ~ match_cv_1                    
    ),
    
    match_cv_2 = case_when(
      match_cv_4 == "No, none of the elements are consistent" & is.na(match_cv_2) ~ "n",  
      (match_cv_0 == "y" | match_cv_1 == "y" | match_cv_3 == "y") & is.na(match_cv_2) ~ "n",       
      TRUE ~ match_cv_2                    
    ),
    
    match_cv_3 = case_when(
      match_cv_4 == "No, none of the elements are consistent" & is.na(match_cv_3) ~ "n",  
      (match_cv_0 == "y" | match_cv_1 == "y" | match_cv_2 == "y") & is.na(match_cv_3) ~ "n",       
      TRUE ~ match_cv_3                    
    ),

    match_mc = ifelse(is.na(match_mc), "x", match_mc),
    match_cv_0 = ifelse(is.na(match_cv_0), "x", match_cv_0),
    match_cv_1 = ifelse(is.na(match_cv_1), "x", match_cv_1),
    match_cv_2 = ifelse(is.na(match_cv_2), "x", match_cv_2),
    match_cv_3 = ifelse(is.na(match_cv_3), "x", match_cv_3)
    # match_cv_4 = ifelse(is.na(match_cv_4), "x", match_cv_4)
)


```


### dcp/iec

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    match_dcp_1 = case_when(
      match_dcp_3 == "No, none of the elements are consistent" & is.na(match_dcp_1) ~ "n",  
      (match_dcp_2 == "y") & is.na(match_dcp_1) ~ "n",       
      TRUE ~ match_dcp_1                    
    ),
    
    match_dcp_2 = case_when(
      match_dcp_3 == "No, none of the elements are consistent" & is.na(match_dcp_2) ~ "n",  
      (match_dcp_1 == "y") & is.na(match_dcp_2) ~ "n",       
      TRUE ~ match_dcp_2                    
    ),
    
  

    match_iec_1 = ifelse(is.na(match_iec_1), "x", match_iec_1),
    match_dcp_1 = ifelse(is.na(match_dcp_1), "x", match_dcp_1),
    match_dcp_2 = ifelse(is.na(match_dcp_2), "x", match_dcp_2),
    #match_dcp_3 = ifelse(is.na(match_dcp_3), "x", match_dcp_3)
)


```


### IMD & SM

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    match_imd_1 = case_when(
      match_imd_3 == "No, none of the elements are consistent" & is.na(match_imd_1) ~ "n",  
      match_imd_2 == "y" & is.na(match_imd_1) ~ "n",       
      TRUE ~ match_imd_1                    
    ),
    
    match_imd_2 = case_when(
      match_imd_3 == "No, none of the elements are consistent" & is.na(match_imd_2) ~ "n",  
      match_imd_1 == "y" & is.na(match_imd_2) ~ "n",       
      TRUE ~ match_imd_2                    
    ),
    
  
    
    match_sm_1 = case_when(
      match_sm_4 == "No, none of the elements are consistent" & is.na(match_sm_1) ~ "n",  
      (match_sm_2 == "y" | match_sm_3 == "y") & is.na(match_sm_1) ~ "n",       
      TRUE ~ match_sm_1                    
    ),
    
    match_sm_2 = case_when(
      match_sm_4 == "No, none of the elements are consistent" & is.na(match_sm_2) ~ "n",  
      (match_sm_1 == "y" | match_sm_3 == "y") & is.na(match_sm_2) ~ "n",       
      TRUE ~ match_sm_2                    
    ),
    
    match_sm_3 = case_when(
      match_sm_4 == "No, none of the elements are consistent" & is.na(match_sm_3) ~ "n",  
      (match_sm_1 == "y" | match_sm_2 == "y") & is.na(match_sm_3) ~ "n",       
      TRUE ~ match_sm_3                    
    ),

    match_imd_1 = ifelse(is.na(match_imd_1), "x", match_imd_1),
    match_imd_2 = ifelse(is.na(match_imd_2), "x", match_imd_2),
    #match_imd_3 = ifelse(is.na(match_imd_3), "x", match_imd_3),
    match_sm_1 = ifelse(is.na(match_sm_1), "x", match_sm_1),
    match_sm_2 = ifelse(is.na(match_sm_2), "x", match_sm_2),
    match_sm_3 = ifelse(is.na(match_sm_3), "x", match_sm_3)
    # match_sm_4 = ifelse(is.na(match_sm_4), "x", match_sm_4)
)


```

### VSA & IC

```{r}
data_olmo_selected_mutated <- data_olmo_selected_mutated %>% mutate(

    match_vsa_1 = case_when(
      match_vsa_4 == "No, none of the elements are consistent" & is.na(match_vsa_1) ~ "n",  
      (match_vsa_2 == "y" | match_vsa_3 == "y") & is.na(match_vsa_1) ~ "n",       
      TRUE ~ match_vsa_1                    
    ),
    
    match_vsa_2 = case_when(
      match_vsa_4 == "No, none of the elements are consistent" & is.na(match_vsa_2) ~ "n",  
      (match_vsa_1 == "y" | match_vsa_3 == "y") & is.na(match_vsa_2) ~ "n",       
      TRUE ~ match_vsa_2                    
    ),
    
    match_vsa_3 = case_when(
      match_vsa_4 == "No, none of the elements are consistent" & is.na(match_vsa_3) ~ "n",  
      (match_vsa_1 == "y" | match_vsa_2 == "y") & is.na(match_vsa_3) ~ "n",       
      TRUE ~ match_vsa_3                    
    ),
    
    match_ic = ifelse(is.na(match_ic), "x", match_ic),
    match_vsa_1 = ifelse(is.na(match_vsa_1), "x", match_vsa_1),
    match_vsa_2 = ifelse(is.na(match_vsa_2), "x", match_vsa_2),
    match_vsa_3 = ifelse(is.na(match_vsa_3), "x", match_vsa_3)
    # match_vsa_4 = ifelse(is.na(match_vsa_4), "x", match_vsa_4)
)


```



### rename

kurze erklärungen: 
- data_gpt_finito hat 330 Einträge, dh 30 mehr als olmo, was auf die 30 retest zurückzuführen ist
- auch wenn die beiden Datensätze eine sehr ähnliche Anzahl von Columns haben (149 und 148) ist die zusammensetzung anders. die gpt categories(118) sind bei beiden enthalten, aber sie haben beide jeweils zusätzliche Kategorien...
```{r}

data_olmo_finito <- data_olmo_selected_mutated 

data_gpt_finito
data_olmo_finito


data_gpt_finito$psp

```


#Data mergen

## 

## 

```{r}


merged_data <- left_join(data_gpt_finito, data_olmo_finito, by = "psp", suffix = c("_gpt", "_olmo"))




```






# compare datasets

## alphabtic comparison

```{r}
# Bereinigen der Spaltenwerte (entfernt Leerzeichen und sorgt für Großbuchstaben)
clean_column <- function(column) {
  return(toupper(trimws(as.character(column))))
}

# Vergleichsfunktion anpassen
compare_columns <- function(gpt_val, olmo_val) {
  gpt_val <- clean_column(gpt_val)
  olmo_val <- clean_column(olmo_val)
  
  if (is.na(gpt_val) || is.na(olmo_val)) {
    return("X")
  }
  
  if (gpt_val == olmo_val) {
    if (gpt_val == "Y") {
      return("Y")
    } else if (gpt_val == "N") {
      return("N")
    } else {
      return("X")
    }
  } else {
    if (gpt_val == "Y" && olmo_val == "N") {
      return("P")
    } else if (gpt_val == "N" && olmo_val == "Y") {
      return("Q")
    } else if (gpt_val == "Y" && olmo_val == "X") {
      return("FY")
    } else if (gpt_val == "N" && olmo_val == "X") {
      return("FN")
    } else if (gpt_val == "X" && olmo_val == "N") {
      return("FXN")
    } else if (gpt_val == "X" && olmo_val == "Y") {
      return("FXY")
    }
  }
}

# Initialisiere den neuen DataFrame mit der psp-Spalte
data_alphabetic_comparison <- data.frame(psp = merged_data$psp)


# Füge die test_retest-Spalte aus dem gpt-Datensatz in den neuen DataFrame ein
data_alphabetic_comparison$test_retest <- merged_data$test_retest


# Vergleich und Erstellen der neuen Spalten mit der Endung _comp
for (category in gpt_categories_alphabetic) {
  # GPT- und Olmo-Spalten auswählen
  gpt_column <- clean_column(merged_data[[paste0(category, "_gpt")]])
  olmo_column <- clean_column(merged_data[[paste0(category, "_olmo")]])
  
  # Überprüfen, ob beide Spalten existieren und die gleiche Länge haben
  if (!is.null(gpt_column) && !is.null(olmo_column) && length(gpt_column) == length(olmo_column)) {
    # Neue Vergleichsspalte erstellen
    data_alphabetic_comparison[[paste0(category, "_comp")]] <- mapply(compare_columns, gpt_column, olmo_column)
  } else {
    # Wenn die Spalten nicht übereinstimmen, fülle die Vergleichsspalte mit NA
    data_alphabetic_comparison[[paste0(category, "_comp")]] <- rep(NA, nrow(merged_data))
    warning(paste("Spalten", category, "haben unterschiedliche Längen oder fehlen."))
  }
}

# Ergebnis anzeigen
head(data_alphabetic_comparison)

data_alphabetic_comparison$psp

colnames(data_alphabetic_comparison)
```


## numeric comparison

PEanalysis of olmos dataset contains different strictness categories than gpt, 

```{r}



```


## merge 

```{r}
colnames(data_gpt_finito)

# Gewünschten Spalten aus data_gpt_finito
selected_columns <- c("psp", "title_pap", "study_pap", "date_gpt", "prompt_version", 
                      "test_retest", "chat_gpt_version", "time_extraction", 
                      "time_comparison", "master_exclude")

# Erstelle einen neuen Datensatz mit nur diesen Spalten
data_gpt_selected <- data_gpt_finito %>% select(all_of(selected_columns))

# Verwende left_join, um die Datensätze via psp und test_retest zu verbinden
data_processed_before_exclusions <- left_join(data_gpt_selected, data_alphabetic_comparison, by = c("psp", "test_retest"))

# Ausgabe des Ergebnisses
head(data_processed_before_exclusions)

# Zeige die psp-Spalte an
data_processed_before_exclusions$psp





```


## remove master exclude

```{r}
# Remove rows where master_exclude column contains "exclude"
data_processed <- data_processed_before_exclusions[data_processed_before_exclusions$master_exclude != "exclude", ]

# Check the resulting data
print(data_processed)



```


## sanity check

```{r}
# Sanity check function for data_processed
sanity_check_processed <- function(df, allowed_values = c("Y", "N", "X", "P", "Q", "FY", "FN", "FXN", "FXY")) {
  invalid_entries <- lapply(df, function(column) {
    if (is.numeric(column)) {
      return(NULL)  # Skip numeric columns for this check
    }
    # Check if any values are not in the allowed set
    invalid <- !column %in% allowed_values
    return(which(invalid))  # Return indices of invalid values
  })
  
  # Filter out columns with no invalid entries
  invalid_entries <- Filter(Negate(is.null), invalid_entries)
  
  if (length(invalid_entries) > 0) {
    return(invalid_entries)  # Return list of invalid entries per column
  } else {
    message("Sanity check passed: All entries are valid.")
    return(NULL)  # No invalid entries found
  }
}

# Run sanity check on data_processed
invalid_entries_processed <- sanity_check_processed(data_processed)

# Check results
if (!is.null(invalid_entries_processed)) {
  print("Invalid entries found:")
  print(invalid_entries_processed)
}



```


## 

```{r}



```

## 

```{r}



```


# Write to disk

```{r}


# save data to disk in that dir
write_csv(data_processed, "../Data/processed/data_processed.csv")

```


# Create codebook template for the processed data


```{r}

if(!file.exists("../data/processed/data_processed_codebook.xlsx")){
  # convert the column names to a df
  codebook_template <- data.frame(variable = colnames(data_processed)) |>
    mutate(explanation = NA)
  # write to disk as an excel file
  write.xlsx(codebook_template, file = "../data/processed/data_processed_codebook.xlsx")
}

```


# Session info

```{r}

sessionInfo()

```


